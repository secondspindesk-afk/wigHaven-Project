generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

// Primary Database: Xata PostgreSQL
// Backup: Neon (see .env.neon-backup)
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                   @id @default(cuid()) @db.VarChar(30)
  email                   String                   @unique @db.VarChar(255)
  password                String                   @db.VarChar(255)
  firstName               String                   @map("first_name") @db.VarChar(100)
  lastName                String                   @map("last_name") @db.VarChar(100)
  phone                   String?                  @db.VarChar(20)
  role                    String                   @default("customer") @db.VarChar(20)
  emailVerified           Boolean                  @default(false) @map("email_verified")
  isActive                Boolean                  @default(true) @map("is_active")
  reviewStatus            String                   @default("standard") @map("review_status") @db.VarChar(20)
  failedLoginAttempts     Int                      @default(0) @map("failed_login_attempts")
  lockedUntil             DateTime?                @map("locked_until")
  lastPasswordChange      DateTime?                @map("last_password_change")
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @updatedAt @map("updated_at")
  abandonedCarts          AbandonedCart[]
  addresses               Address[]
  adminActivities         AdminActivity[]
  backInStockAlerts       BackInStockAlert[]
  cart                    Cart?
  emailPreferences        EmailPreferences?        @relation("EmailPreferences")
  emailVerificationTokens EmailVerificationToken[]
  trashedMedia            Media[]                  @relation("TrashedMedia")
  uploadedMedia           Media[]                  @relation("UploadedMedia")
  notifications           Notification[]
  orders                  Order[]
  passwordResetTokens     PasswordResetToken[]
  createdBanners          PromotionalBanner[]      @relation("BannerCreator")
  reviewVotes             ReviewVote[]
  reviews                 Review[]
  stockMovements          StockMovement[]          @relation("CreatedBy")
  supportMessages         SupportMessage[]
  supportTickets          SupportTicket[]
  wishlist                Wishlist[]

  @@index([email])
  @@index([role])
  @@index([createdAt])
  @@map("users")
}

model Product {
  id          String     @id @default(cuid()) @db.VarChar(30)
  name        String     @db.VarChar(255)
  description String
  basePrice   Decimal    @map("base_price") @db.Decimal(10, 2)
  categoryId  String     @map("category_id") @db.VarChar(30)
  images      String[]
  isActive    Boolean    @default(true) @map("is_active")
  isFeatured  Boolean    @default(false) @map("is_featured")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  category    Category   @relation(fields: [categoryId], references: [id])
  reviews     Review[]
  variants    Variant[]
  wishlist    Wishlist[]

  @@index([categoryId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([createdAt])
  @@map("products")
}

model Category {
  id          String    @id @default(cuid()) @db.VarChar(30)
  name        String    @unique @db.VarChar(100)
  slug        String    @unique @db.VarChar(100)
  description String?
  image       String?   @db.VarChar(255)
  isActive    Boolean   @default(true) @map("is_active")
  isFeatured  Boolean   @default(false) @map("is_featured")
  type        String    @default("standard") @db.VarChar(20)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  products    Product[]

  @@index([isActive])
  @@index([type])
  @@map("categories")
}

model Variant {
  id                String             @id @default(cuid()) @db.VarChar(30)
  productId         String             @map("product_id") @db.VarChar(30)
  sku               String             @unique @db.VarChar(100)
  price             Decimal            @db.Decimal(10, 2)
  stock             Int                @default(0)
  reservedStock     Int                @default(0) @map("reserved_stock")
  length            String?            @db.VarChar(50)
  color             String?            @db.VarChar(50)
  texture           String?            @db.VarChar(50)
  size              String?            @db.VarChar(50)
  images            String[]
  isActive          Boolean            @default(true) @map("is_active")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  backInStockAlerts BackInStockAlert[]
  cartItems         CartItem[]
  guestCartItems    GuestCartItem[]
  orderItems        OrderItem[]
  stockMovements    StockMovement[]
  product           Product            @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, color, length, texture, size], name: "variant_attributes_unique")
  @@index([productId])
  @@index([sku])
  @@index([stock])
  @@index([productId, isActive])
  @@map("variants")
}

model Order {
  id                 String          @id @default(cuid()) @db.VarChar(30)
  userId             String?         @map("user_id") @db.VarChar(30)
  orderNumber        String          @unique @map("order_number") @db.VarChar(50)
  status             String          @default("pending") @db.VarChar(20)
  paymentStatus      String          @default("pending") @map("payment_status") @db.VarChar(30)
  paymentMethod      String?         @map("payment_method") @db.VarChar(50)
  paystackReference  String?         @unique @map("paystack_reference") @db.VarChar(100)
  paystackAccessCode String?         @map("paystack_access_code") @db.VarChar(100)
  subtotal           Decimal         @db.Decimal(10, 2)
  shipping           Decimal         @db.Decimal(10, 2)
  tax                Decimal         @db.Decimal(10, 2)
  discount           Decimal         @default(0) @db.Decimal(10, 2)
  couponCode         String?         @map("coupon_code") @db.VarChar(50)
  total              Decimal         @db.Decimal(10, 2)
  customerEmail      String          @map("customer_email") @db.VarChar(255)
  customerPhone      String          @map("customer_phone") @db.VarChar(20)
  shippingAddress    Json            @map("shipping_address")
  billingAddress     Json?           @map("billing_address")
  trackingNumber     String?         @map("tracking_number") @db.VarChar(100)
  notes              String?
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  paidAt             DateTime?       @map("paid_at")
  shippedAt          DateTime?       @map("shipped_at")
  deliveredAt        DateTime?       @map("delivered_at")
  items              OrderItem[]
  user               User?           @relation(fields: [userId], references: [id])
  stockMovements     StockMovement[]

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@index([paymentStatus])
  @@index([paystackReference])
  @@index([createdAt])
  @@index([status, createdAt])
  @@index([customerEmail])
  @@index([couponCode])
  @@index([userId, paymentStatus])
  @@map("orders")
}

model OrderItem {
  id          String   @id @default(cuid()) @db.VarChar(30)
  orderId     String   @map("order_id") @db.VarChar(30)
  variantId   String   @map("variant_id") @db.VarChar(30)
  productName String   @map("product_name") @db.VarChar(255)
  variantSku  String   @map("variant_sku") @db.VarChar(100)
  attributes  Json?
  quantity    Int
  unitPrice   Decimal  @map("unit_price") @db.Decimal(10, 2)
  subtotal    Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now()) @map("created_at")
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  variant     Variant  @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@index([variantId])
  @@map("order_items")
}

model Address {
  id        String   @id @default(cuid()) @db.VarChar(30)
  userId    String   @map("user_id") @db.VarChar(30)
  name      String   @db.VarChar(255)
  address   String
  city      String   @db.VarChar(100)
  state     String   @db.VarChar(100)
  zipCode   String   @map("zip_code") @db.VarChar(20)
  country   String   @db.VarChar(100)
  phone     String   @db.VarChar(20)
  isDefault Boolean  @default(false) @map("is_default")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("addresses")
}

model Review {
  id           String       @id @default(cuid()) @db.VarChar(30)
  productId    String       @map("product_id") @db.VarChar(30)
  userId       String?      @map("user_id") @db.VarChar(30)
  orderId      String?      @map("order_id") @db.VarChar(30)
  rating       Int
  title        String       @db.VarChar(255)
  content      String
  images       String[]
  authorName   String       @map("author_name") @db.VarChar(255)
  isVerified   Boolean      @default(false) @map("is_verified")
  isApproved   Boolean      @default(false) @map("is_approved")
  helpfulCount Int          @default(0) @map("helpful_count")
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  votes        ReviewVote[]
  product      Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  user         User?        @relation(fields: [userId], references: [id])

  @@index([productId])
  @@index([isApproved])
  @@index([productId, isApproved])
  @@map("reviews")
}

model ReviewVote {
  id        String   @id @default(cuid()) @db.VarChar(30)
  reviewId  String   @map("review_id") @db.VarChar(30)
  userId    String   @map("user_id") @db.VarChar(30)
  createdAt DateTime @default(now()) @map("created_at")
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([reviewId, userId])
  @@index([reviewId])
  @@index([userId])
  @@map("review_votes")
}

model Wishlist {
  id        String   @id @default(cuid()) @db.VarChar(30)
  userId    String   @map("user_id") @db.VarChar(30)
  productId String   @map("product_id") @db.VarChar(30)
  createdAt DateTime @default(now()) @map("created_at")
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
  @@map("wishlist")
}

model Notification {
  id        String    @id @default(cuid()) @db.VarChar(30)
  userId    String    @map("user_id") @db.VarChar(30)
  type      String    @db.VarChar(50)
  title     String    @db.VarChar(255)
  message   String
  link      String?   @db.VarChar(500)
  isRead    Boolean   @default(false) @map("is_read")
  data      Json?
  createdAt DateTime  @default(now()) @map("created_at")
  expiresAt DateTime? @map("expires_at")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@index([userId, isRead])
  @@map("notifications")
}

model DiscountCode {
  id              String   @id @default(cuid()) @db.VarChar(30)
  code            String   @unique @db.VarChar(50)
  type            String   @db.VarChar(20)
  value           Decimal  @db.Decimal(10, 2)
  minimumPurchase Decimal? @map("minimum_purchase") @db.Decimal(10, 2)
  maxUses         Int?     @map("max_uses")
  usedCount       Int      @default(0) @map("used_count")
  usesPerCustomer Int      @default(1) @map("uses_per_customer")
  startsAt        DateTime @map("starts_at")
  expiresAt       DateTime @map("expires_at")
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@index([code])
  @@index([isActive])
  @@map("discount_codes")
}

model BackInStockAlert {
  id         String    @id @default(cuid()) @db.VarChar(30)
  userId     String    @map("user_id") @db.VarChar(30)
  variantId  String    @map("variant_id") @db.VarChar(30)
  email      String    @db.VarChar(255)
  notified   Boolean   @default(false)
  createdAt  DateTime  @default(now()) @map("created_at")
  notifiedAt DateTime? @map("notified_at")
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  variant    Variant   @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([userId, variantId])
  @@index([userId])
  @@index([variantId])
  @@index([notified])
  @@map("back_in_stock_alerts")
}

model AbandonedCart {
  id             String    @id @default(cuid()) @db.VarChar(30)
  userId         String?   @map("user_id") @db.VarChar(30)
  email          String    @db.VarChar(255)
  sessionId      String?   @map("session_id") @db.VarChar(100)
  cartData       Json      @map("cart_data")
  emailSent      Boolean   @default(false) @map("email_sent")
  emailSentAt    DateTime? @map("email_sent_at")
  recovered      Boolean   @default(false)
  recoveredAt    DateTime? @map("recovered_at")
  createdAt      DateTime  @default(now()) @map("created_at")
  lastReminderAt DateTime? @map("last_reminder_at")
  user           User?     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([email])
  @@index([emailSent])
  @@index([createdAt])
  @@map("abandoned_carts")
}

model Analytic {
  id        String   @id @default(cuid()) @db.VarChar(30)
  date      DateTime @db.Date
  metric    String   @db.VarChar(100)
  value     Decimal  @db.Decimal(15, 2)
  metadata  Json?
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([date, metric])
  @@index([date])
  @@index([metric])
  @@index([date, metric])
  @@map("analytics")
}

model StockMovement {
  id            String   @id @default(cuid()) @db.VarChar(30)
  variantId     String   @map("variant_id") @db.VarChar(30)
  orderId       String?  @map("order_id") @db.VarChar(30)
  type          String   @db.VarChar(20)
  quantity      Int
  previousStock Int      @map("previous_stock")
  newStock      Int      @map("new_stock")
  reason        String?
  createdBy     String?  @map("created_by") @db.VarChar(30)
  createdAt     DateTime @default(now()) @map("created_at")
  creator       User?    @relation("CreatedBy", fields: [createdBy], references: [id])
  order         Order?   @relation(fields: [orderId], references: [id])
  variant       Variant  @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([variantId])
  @@index([orderId])
  @@index([type])
  @@index([createdAt])
  @@map("stock_movements")
}

model AdminActivity {
  id         String   @id @default(cuid()) @db.VarChar(30)
  adminId    String   @map("admin_id") @db.VarChar(30)
  action     String   @db.VarChar(100)
  entityType String   @map("entity_type") @db.VarChar(50)
  entityId   String   @map("entity_id") @db.VarChar(30)
  changes    Json?
  ipAddress  String?  @map("ip_address") @db.VarChar(45)
  createdAt  DateTime @default(now()) @map("created_at")
  admin      User     @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("admin_activities")
}

model Cart {
  id         String     @id @default(cuid()) @db.VarChar(30)
  userId     String?    @unique @map("user_id") @db.VarChar(30)
  sessionId  String?    @unique @map("session_id") @db.VarChar(100)
  couponCode String?    @map("coupon_code") @db.VarChar(50)
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime   @updatedAt @map("updated_at")
  items      CartItem[]
  user       User?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@map("carts")
}

model CartItem {
  id        String   @id @default(cuid()) @db.VarChar(30)
  cartId    String   @map("cart_id") @db.VarChar(30)
  variantId String   @map("variant_id") @db.VarChar(30)
  quantity  Int
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  variant   Variant  @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([cartId, variantId])
  @@index([cartId])
  @@index([variantId])
  @@map("cart_items")
}

model WebhookLog {
  id             String   @id @default(cuid()) @db.VarChar(30)
  provider       String   @default("paystack") @db.VarChar(20)
  reference      String   @unique @db.VarChar(100)
  event          String   @db.VarChar(50)
  status         String   @db.VarChar(20)
  payload        Json
  errorMessage   String?  @map("error_message")
  orderId        String?  @map("order_id") @db.VarChar(30)
  responseTimeMs Int?     @map("response_time_ms")
  isProcessed    Boolean  @default(false) @map("is_processed")
  createdAt      DateTime @default(now()) @map("created_at")

  @@index([reference])
  @@index([event])
  @@index([status])
  @@index([createdAt])
  @@map("webhook_logs")
}

model EmailLog {
  id           String    @id @default(cuid()) @db.VarChar(30)
  type         String    @db.VarChar(50)
  toEmail      String    @map("to_email") @db.VarChar(255)
  subject      String    @db.VarChar(255)
  body         String?
  status       String    @db.VarChar(20)
  attemptCount Int       @default(1) @map("attempt_count")
  maxAttempts  Int       @default(3) @map("max_attempts")
  lastError    String?   @map("last_error")
  messageId    String?   @map("message_id") @db.VarChar(255)
  templateData Json?     @map("template_data")
  sentAt       DateTime? @map("sent_at")
  createdAt    DateTime  @default(now()) @map("created_at")

  @@index([toEmail])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@map("email_logs")
}

model EmailPreferences {
  id                  String   @id @default(cuid()) @db.VarChar(30)
  userId              String?  @unique @map("user_id") @db.VarChar(30)
  email               String   @unique @db.VarChar(255)
  unsubscribedFromAll Boolean  @default(false) @map("unsubscribed_from_all")
  marketingEmails     Boolean  @default(true) @map("marketing_emails")
  abandonedCartEmails Boolean  @default(true) @map("abandoned_cart_emails")
  backInStockEmails   Boolean  @default(true) @map("back_in_stock_emails")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  user                User?    @relation("EmailPreferences", fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
  @@map("email_preferences")
}

model GuestCart {
  id         String          @id @default(cuid()) @db.VarChar(30)
  sessionId  String          @unique @map("session_id") @db.VarChar(100)
  couponCode String?         @map("coupon_code") @db.VarChar(50)
  createdAt  DateTime        @default(now()) @map("created_at")
  updatedAt  DateTime        @updatedAt @map("updated_at")
  items      GuestCartItem[]

  @@map("guest_carts")
}

model GuestCartItem {
  id        String    @id @default(cuid()) @db.VarChar(30)
  cartId    String    @map("cart_id") @db.VarChar(30)
  variantId String    @map("variant_id") @db.VarChar(30)
  quantity  Int
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  cart      GuestCart @relation(fields: [cartId], references: [id], onDelete: Cascade)
  variant   Variant   @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([cartId, variantId])
  @@index([cartId])
  @@index([variantId])
  @@map("guest_cart_items")
}

model PasswordResetToken {
  id        String   @id @default(cuid()) @db.VarChar(30)
  userId    String   @map("user_id") @db.VarChar(30)
  token     String   @unique @db.VarChar(255)
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("password_reset_tokens")
}

model BlacklistedToken {
  id        String   @id @default(cuid()) @db.VarChar(30)
  token     String   @unique @db.VarChar(512)
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([expiresAt])
  @@map("blacklisted_tokens")
}

model EmailVerificationToken {
  id        String   @id @default(cuid()) @db.VarChar(30)
  userId    String   @map("user_id") @db.VarChar(30)
  token     String   @unique @db.VarChar(255)
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("email_verification_tokens")
}

model SystemSetting {
  id          String   @id @default(cuid()) @db.VarChar(30)
  key         String   @unique @db.VarChar(50)
  value       String
  description String?  @db.VarChar(255)
  updatedBy   String?  @map("updated_by") @db.VarChar(30)
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("system_settings")
}

model BlockedIP {
  id        String   @id @default(cuid()) @db.VarChar(30)
  ip        String   @unique @db.VarChar(45)
  reason    String?  @db.VarChar(255)
  blockedBy String?  @map("blocked_by") @db.VarChar(30)
  createdAt DateTime @default(now()) @map("created_at")

  @@map("blocked_ips")
}

model Media {
  id         String    @id @default(cuid()) @db.VarChar(30)
  fileId     String    @unique @db.VarChar(100)
  fileName   String    @db.VarChar(255)
  filePath   String    @db.VarChar(500)
  url        String    @db.VarChar(500)
  fileHash   String?   @map("file_hash") @db.VarChar(64)
  type       String    @db.VarChar(50)
  mimeType   String    @map("mime_type") @db.VarChar(50)
  size       Int
  width      Int?
  height     Int?
  uploadedBy String    @map("uploaded_by") @db.VarChar(30)
  usedBy     String?   @map("used_by") @db.VarChar(30)
  usageType  String?   @map("usage_type") @db.VarChar(50)
  status     String    @default("active") @db.VarChar(20)
  trashedAt  DateTime? @map("trashed_at")
  trashedBy  String?   @map("trashed_by") @db.VarChar(30)
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  trasher    User?     @relation("TrashedMedia", fields: [trashedBy], references: [id])
  uploader   User      @relation("UploadedMedia", fields: [uploadedBy], references: [id])

  @@index([fileId])
  @@index([fileHash])
  @@index([type])
  @@index([status])
  @@index([uploadedBy])
  @@index([usedBy, usageType])
  @@index([status, trashedAt])
  @@map("media")
}

model PromotionalBanner {
  id          String   @id @default(cuid()) @db.VarChar(30)
  title       String   @db.VarChar(255)
  description String?
  imageUrl    String   @map("image_url") @db.VarChar(500)
  linkUrl     String?  @map("link_url") @db.VarChar(500)
  startDate   DateTime @map("start_date")
  endDate     DateTime @map("end_date")
  isActive    Boolean  @default(true) @map("is_active")
  priority    Int      @default(0)
  createdBy   String   @map("created_by") @db.VarChar(30)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  creator     User     @relation("BannerCreator", fields: [createdBy], references: [id])

  @@index([isActive, priority])
  @@index([startDate, endDate])
  @@map("promotional_banners")
}

model AdminMilestone {
  id             String    @id @default(cuid()) @db.VarChar(30)
  type           String    @db.VarChar(50)
  threshold      Decimal   @db.Decimal(15, 2)
  currentValue   Decimal   @default(0) @map("current_value") @db.Decimal(15, 2)
  isReached      Boolean   @default(false) @map("is_reached")
  reachedAt      DateTime? @map("reached_at")
  notifiedAdmins Boolean   @default(false) @map("notified_admins")
  createdAt      DateTime  @default(now()) @map("created_at")

  @@unique([type, threshold])
  @@index([isReached])
  @@map("admin_milestones")
}

model CurrencyRate {
  id           String   @id @default(cuid()) @db.VarChar(30)
  baseCurrency String   @default("GHS") @map("base_currency") @db.VarChar(3)
  currency     String   @db.VarChar(3)
  rate         Decimal  @db.Decimal(10, 6)
  lastUpdated  DateTime @default(now()) @map("last_updated")
  createdAt    DateTime @default(now()) @map("created_at")

  @@unique([baseCurrency, currency])
  @@index([currency])
  @@index([lastUpdated])
  @@map("currency_rates")
}

model SupportTicket {
  id           String           @id @default(cuid()) @db.VarChar(30)
  ticketNumber Int              @unique @default(autoincrement()) @map("ticket_number")
  userId       String?          @map("user_id") @db.VarChar(30)
  subject      String           @db.VarChar(255)
  status       String           @default("open") @db.VarChar(20)
  priority     String           @default("medium") @db.VarChar(20)
  guestName    String?          @map("guest_name") @db.VarChar(100)
  guestEmail   String?          @map("guest_email") @db.VarChar(255)
  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")
  messages     SupportMessage[]
  user         User?            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([priority])
  @@index([createdAt])
  @@index([guestEmail])
  @@map("support_tickets")
}

model SupportMessage {
  id        String        @id @default(cuid()) @db.VarChar(30)
  ticketId  String        @map("ticket_id") @db.VarChar(30)
  senderId  String?       @map("sender_id") @db.VarChar(30)
  message   String
  isAdmin   Boolean       @default(false) @map("is_admin")
  createdAt DateTime      @default(now()) @map("created_at")
  sender    User?         @relation(fields: [senderId], references: [id], onDelete: Cascade)
  ticket    SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([senderId])
  @@index([createdAt])
  @@map("support_messages")
}
